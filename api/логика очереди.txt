состав

Set - список объектов

Symbol.iterator  - итератор  с мотодом .next()
Возвращает 2 параметра
.value  - следующий объект
.done - true если конец и false если нет

стек  - просто массив, хранит вложенность команд

генератор - функция со * и yield
.value -  значение из yield.
.done - true если конец и false если нет

стек позволяет организовать большую вложенность команд
ожидаемая вложенность 3-4 уровня
3 очередь, команда внешнего АПИ, команда внутренного АПИ
4 очередь, команда внешнего АПИ, составная команда внутренного АПИ, одиночная команда

проверка ошибок ответа и их обработка
обработка нет ответа
обработка ошибка сокета
обработка ответа ошибки

во всех случаях: 
- очищаем стек до уровня очереди
- ставим флаг потеря связи у конвертера и счетчик потерь у контроллера (это разные события)
- передаем ответ текущему шагу с сообщением об ошибке, сообщение транслируется тому кто добавил команду в очередь
- штатный переход к следующему шагу



можно анализировать счетчик команд
если меньше  то игнорируем, откатываемя на шаг = команду, ожидаем 0,1 сек если нет ответа то сбрасываем команду с сообщением об ошибке.

ищем способ определения потери связи
варианты
1) отправить команду и получить ошибку  - работает

Для клиента, нужен алгоритм восстановления связи.  
- через seek